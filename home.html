<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>BrickBugs â€“ Dashboard</title>
  <style>
    body{margin:0;font-family:Arial;background:#e3f2fd;}
    .navbar{background:#007bff;color:#fff;padding:10px 20px;display:flex;justify-content:space-between;align-items:center;}
    .logo{font-weight:bold;font-size:1.5em;}
    .nav-links a{color:#fff;text-decoration:none;margin-left:15px;}
    .user-info{display:flex;align-items:center;gap:10px;}
    .content{padding:20px;}
    button{background:#4caf50;color:#fff;border:none;padding:8px 12px;border-radius:5px;cursor:pointer;}
  </style>
</head>
<body>
<div class="navbar">
  <div class="logo">BrickBugs</div>
  <div class="nav-links">
    <a href="home.html">ğŸ  Home</a>
    <a href="forums.html">ğŸ—¨ï¸ Forums</a>
  </div>
  <div id="user-info" class="user-info">Loadingâ€¦</div>
</div>

<div class="content">
  <h2>Welcome to BrickBugs!</h2>
  <p>This is your account dashboard.</p>
  <button id="earn-btn" onclick="earnCubeBucks()">ğŸ’¸ Get Cube Bucks</button><br><br>
  <button onclick="location.href='cubegametest.html'">ğŸŸ¦ Play Cube Sandbox</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getFirestore, doc, getDoc, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = { /* â€¦same configâ€¦ */ };
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getFirestore(app);

let uid = null;

onAuthStateChanged(auth, async user=>{
  const info = document.getElementById("user-info");
  if(!user){ location.href="index.html"; return; }
  uid = user.uid;
  const snap = await getDoc(doc(db,"users",uid));
  const data = snap.data();
  if(data.cubeBucks===undefined){ await setDoc(doc(db,"users",uid),{cubeBucks:0},{merge:true}); data.cubeBucks=0; }

  info.innerHTML = `
    ğŸ‘¤ <strong>${data.username}</strong> |
    ğŸ’° CubeÂ Bucks: <span id="cube">${data.cubeBucks}</span>
    <button onclick="logout()">Logout</button>
  `;
});

window.logout = ()=>signOut(auth);
window.earnCubeBucks = async ()=>{
  if(!uid) return;
  const ref = doc(db,"users",uid);
  const snap = await getDoc(ref);
  const val  = (snap.data().cubeBucks||0)+10;
  await updateDoc(ref,{cubeBucks:val});
  document.getElementById("cube").textContent = val;
};
</script>
</body>
</html>
