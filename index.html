<!DOCTYPE html>
<html>
<head>
  <title>Sign Up / Log In</title>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: Arial; background:#cbe8ff; display:flex; justify-content:center; align-items:center; height:100vh; }
    .box{background:#fff; padding:20px; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,.2); width:300px;}
    input,select,button{width:100%; margin-top:10px; padding:10px;}
    .message{margin-top:10px; text-align:center;}
    h2{margin-bottom:5px;} hr{margin:20px 0;}
  </style>
</head>
<body>
  <div class="box">
    <h2>Create Account</h2>
    <input id="signup-username" placeholder="Username"                  required>
    <input id="signup-email"    placeholder="Email (kept private)" type="email" required>
    <input id="signup-password" placeholder="Password"            type="password" required>
    <select id="gender">
      <option value="">Select Gender</option>
      <option value="Boy">Boy</option>
      <option value="Girl">Girl</option>
    </select>
    <button onclick="signup()">Sign Up</button>

    <hr>

    <h2>Log In</h2>
    <input id="login-username" placeholder="Username" required>
    <input id="login-password" placeholder="Password" type="password" required>
    <button onclick="login()">Log In</button>

    <div class="message" id="message"></div>
  </div>

<script>
/* ---------- Firebase ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyCkjACpngpo9U96StM2Z1Y9Q7B3XtNSIQ0",
  authDomain: "gametest2-ba5fe.firebaseapp.com",
  projectId: "gametest2-ba5fe",
  storageBucket: "gametest2-ba5fe.appspot.com",
  messagingSenderId: "1063979387642",
  appId: "1:1063979387642:web:307e4621ae0394bcb49743"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db   = firebase.firestore();

/* ---------- Sign‑up ---------- */
async function signup() {
  const username = document.getElementById("signup-username").value.trim();
  const email    = document.getElementById("signup-email").value.trim();
  const password = document.getElementById("signup-password").value.trim();
  const gender   = document.getElementById("gender").value;
  const msg      = document.getElementById("message");

  if (!username || !email || !password || !gender) {
    msg.textContent = "Please fill out every field."; msg.style.color="red"; return;
  }

  /* (Optional) check if username is taken */
  const existing = await db.collection("users").where("username","==",username).limit(1).get();
  if (!existing.empty) { msg.textContent="Username already in use."; msg.style.color="red"; return; }

  try {
    const { user } = await auth.createUserWithEmailAndPassword(email,password);
    await db.collection("users").doc(user.uid).set({
      username, email, gender, createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    msg.textContent = "Account created! Redirecting…"; msg.style.color="green";
    setTimeout(()=>location.href="dashboard.html",1500);
  } catch(e){ msg.textContent=e.message; msg.style.color="red"; }
}

/* ---------- Log‑in with username ---------- */
async function login() {
  const username = document.getElementById("login-username").value.trim();
  const password = document.getElementById("login-password").value.trim();
  const msg      = document.getElementById("message");

  if (!username || !password) { msg.textContent="Enter username & password."; msg.style.color="red"; return; }

  try {
    /* 1️⃣ Look up email that belongs to this username */
    const snap = await db.collection("users").where("username","==",username).limit(1).get();
    if (snap.empty) throw new Error("Username not found.");
    const userDoc = snap.docs[0].data();
    /* 2️⃣ Sign‑in with the underlying email */
    await auth.signInWithEmailAndPassword(userDoc.email,password);
    msg.textContent="Login successful! Redirecting…"; msg.style.color="green";
    setTimeout(()=>location.href="dashboard.html",1500);
  } catch(e){ msg.textContent=e.message; msg.style.color="red"; }
}
</script>
</body>
</html>
