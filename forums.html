<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>BrickBugs ‚Äì Forums</title>
<style>
 body{font-family:Arial;background:#f0f0f0;margin:0;}
 .navbar{background:#007bff;color:#fff;padding:10px 20px;display:flex;justify-content:space-between;align-items:center;}
 .navbar a{color:#fff;text-decoration:none;margin-left:15px;}
 .content{padding:20px;}
 textarea{width:100%;min-height:60px;padding:10px;margin-bottom:10px;}
 button{background:#28a745;color:#fff;border:none;padding:8px 14px;border-radius:5px;cursor:pointer;}
 .post{background:#fff;padding:10px;border-radius:5px;margin-bottom:10px;box-shadow:0 2px 4px rgba(0,0,0,.1);}
</style>
</head>
<body>
<div class="navbar">
  <div class="logo">BrickBugs</div>
  <div>
    <a href="home.html">üè† Home</a>
    <a href="forums.html">üó®Ô∏è Forums</a>
  </div>
</div>

<div class="content">
  <h2>üó®Ô∏è Community Forums</h2>
  <textarea id="post-content" placeholder="What's on your mind?"></textarea>
  <button onclick="submitPost()">Post</button>
  <div id="post-list"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import {
  getFirestore, collection, addDoc,
  query, orderBy, onSnapshot, serverTimestamp, doc, getDoc
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = { /* ‚Ä¶same config‚Ä¶ */ };
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db   = getFirestore(app);

let currentUser = null, currentUsername = "";

onAuthStateChanged(auth, async user=>{
  if(!user){ location.href="index.html"; return; }
  currentUser = user;
  const snap  = await getDoc(doc(db,"users",user.uid));
  currentUsername = snap.data().username;
  loadPosts();
});

window.submitPost = async ()=>{
  const content = document.getElementById("post-content").value.trim();
  if(!content) return alert("Post cannot be empty.");
  await addDoc(collection(db,"forumPosts"),{
    uid: currentUser.uid,
    username: currentUsername,
    content,
    timestamp: serverTimestamp()
  });
  document.getElementById("post-content").value="";
};

function loadPosts(){
  const list = document.getElementById("post-list");
  const q = query(collection(db,"forumPosts"),orderBy("timestamp","desc"));
  onSnapshot(q,snap=>{
    list.innerHTML="";
    snap.forEach(docSnap=>{
      const p=docSnap.data();
      const div=document.createElement("div");
      div.className="post";
      div.innerHTML=`<strong>${p.username}</strong><br>
                     <p>${p.content}</p>
                     <small>${p.timestamp?.toDate().toLocaleString()||"Just now"}</small>`;
      list.appendChild(div);
    });
  });
}
</script>
</body>
</html>
